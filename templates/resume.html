<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IntelliPrep - Resume Analyzer</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;}

body{
font-family:'Inter',sans-serif;
background:linear-gradient(135deg,#f5f7fa 0%,#e8ecf1 100%);
color:#1a202c;
}

.logo-img{
    width:40px;
    height:40px;
    object-fit:contain;
    border-radius:10px;
}

/* NAV */
.top-nav{background:white;padding:20px 40px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 8px rgba(0,0,0,.04);position:sticky;top:0;z-index:100;}
.logo-section{display:flex;align-items:center;gap:12px;}
.logo-text{font-size:22px;font-weight:800;}
.user-avatar{width:44px;height:44px;border-radius:12px;background:linear-gradient(135deg,#6366F1 0%,#8B5CF6 100%);}

/* LAYOUT */
.container{display:flex;min-height:calc(100vh - 84px);}
.sidebar{width:280px;background:white;padding:24px;box-shadow:2px 0 12px rgba(0,0,0,.04);}
.menu-link{display:block;padding:14px 16px;margin-bottom:8px;border-radius:12px;text-decoration:none;color:#64748b;font-weight:600;}
.menu-link.active{background:linear-gradient(135deg,#6366F1 0%,#8B5CF6 100%);color:white;}
.menu-link:hover{background:#f8fafc;}

.main-content{flex:1;padding:40px;animation:fadeInUp .6s ease;}
@keyframes fadeInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}

/* HEADER */
.page-header h1{font-size:30px;font-weight:800;margin-bottom:22px}

/* UPLOAD AREA */
.upload-grid{display:grid;grid-template-columns:1fr 1fr;gap:22px;margin-bottom:22px}

.card{
background:white;
padding:24px;
border-radius:18px;
box-shadow:0 4px 12px rgba(0,0,0,.05);
}

.upload-box{
border:2px dashed #c7d2fe;
border-radius:18px;
padding:50px 20px;
text-align:center;
transition:.3s;
cursor:pointer;
display:flex;
flex-direction:column;
align-items:center;
justify-content:center;
background:linear-gradient(180deg,#ffffff 0%,#f8fafc 100%);
}

.upload-box:hover{
background:#f8fafc;
border-color:#6366F1;
transform:translateY(-2px);
box-shadow:0 10px 24px rgba(99,102,241,.12);
}

.upload-icon{
width:70px;
height:70px;
border-radius:18px;
background:linear-gradient(135deg,#6366F1 0%,#8B5CF6 100%);
display:flex;
align-items:center;
justify-content:center;
font-size:34px;
color:white;
margin-bottom:14px;
box-shadow:0 8px 20px rgba(99,102,241,.35);
}

.upload-box h4{font-size:18px;font-weight:700;margin-bottom:6px;}
.upload-box p{font-size:14px;color:#64748b;}
.upload-box input{display:none;}

textarea{
width:100%;
min-height:200px;
padding:14px;
border-radius:12px;
border:1px solid #e2e8f0;
resize:vertical;
font-size:14px;
}

/* BUTTON */
.actions{text-align:right;margin-bottom:26px}
.btn-primary{
background:linear-gradient(135deg,#6366F1 0%,#8B5CF6 100%);
color:white;
border:none;
padding:12px 30px;
border-radius:12px;
font-weight:600;
cursor:pointer;
box-shadow:0 8px 20px rgba(99,102,241,.3)
}

/* RESULTS */
.results-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:22px;margin-bottom:22px}

.score{font-size:42px;font-weight:800;color:#6366F1;}

.skill-tag{
display:inline-block;
padding:6px 12px;
border-radius:20px;
background:#eef2ff;
color:#4338ca;
font-weight:600;
margin:4px 4px 0 0;
font-size:13px;
}

.missing{background:#fee2e2;color:#991b1b}

.suggestion{
background:#f8fafc;
padding:10px;
border-radius:10px;
margin-bottom:10px;
}
</style>
</head>

<body>

<nav class="top-nav">
<div class="logo-section">
<img src="{{ url_for('static', filename='images/Logo.jpeg') }}" class="logo-img">
<span class="logo-text">IntelliPrep</span>
</div>
<div class="user-avatar"></div>
</nav>

<div class="container">

<aside class="sidebar">
<a href="{{ url_for('dashboard') }}" class="menu-link">Dashboard</a>
<a href="{{ url_for('interview') }}" class="menu-link">Interview Practice</a>
<a href="{{ url_for('resume') }}" class="menu-link active">Resume Analyzer</a>
<a href="{{ url_for('progress') }}" class="menu-link">Progress</a>
</aside>

<main class="main-content">

<div class="page-header">
<h1>üìÑ Resume Analyzer</h1>
</div>

<!-- FORM -->
<form method="POST" action="{{ url_for('analyze_resume') }}" enctype="multipart/form-data">

<div class="upload-grid">

<div class="card">
<h3>Upload Resume</h3><br>

<label class="upload-box">
<div class="upload-icon">üì§</div>
<h4>Click to upload or drag & drop</h4>
<p>PDF / DOCX supported</p>
<input type="file" name="resume" accept=".pdf,.doc,.docx" required>
</label>
</div>

<div class="card">
<h3>Job Description</h3><br>
<textarea name="job_description" placeholder="Paste job description here..." required></textarea>
</div>

</div>

<div class="actions">
<button type="submit" class="btn-primary">Analyze Resume</button>
</div>

</form>

<!-- RESULTS (demo placeholders for now) -->
<div class="results-grid">
<div class="card">
<h3>ATS Score</h3>
<div class="score">76%</div>
<p style="color:#64748b">Resume compatibility score</p>
</div>

<div class="card">
<h3>Matched Skills</h3><br>
<span class="skill-tag">Python</span>
<span class="skill-tag">Machine Learning</span>
<span class="skill-tag">SQL</span>
<span class="skill-tag">Data Analysis</span>
</div>

<div class="card">
<h3>Missing Keywords</h3><br>
<span class="skill-tag missing">Docker</span>
<span class="skill-tag missing">AWS</span>
<span class="skill-tag missing">NLP</span>
</div>
</div>

<div class="card">
<h3>AI Suggestions</h3><br>
<div class="suggestion">‚úî Add cloud technologies like AWS or Azure.</div>
<div class="suggestion">‚úî Include measurable achievements.</div>
<div class="suggestion">‚úî Improve skill section formatting.</div>
</div>

</main>
</div>
<script>
/* ================================
   1Ô∏è‚É£ Show Selected File Name
=================================*/
const fileInput = document.querySelector("input[name='resume']");
const uploadBox = document.querySelector(".upload-box h4");

fileInput.addEventListener("change", function () {
    if (this.files.length > 0) {
        uploadBox.textContent = this.files[0].name;
    }
});


/* ================================
   2Ô∏è‚É£ Handle Resume Analysis via AJAX
=================================*/
const form = document.querySelector("form");

form.addEventListener("submit", async function (e) {
    e.preventDefault();   // STOP normal page reload

    const formData = new FormData(form);

    try {
        const response = await fetch("{{ url_for('analyze_resume') }}", {
            method: "POST",
            body: formData
        });

        const data = await response.json();

        if (!response.ok) {
            alert(data.error || "Error analyzing resume");
            return;
        }

        // 3Ô∏è‚É£ Update Results Section Dynamically
        document.querySelector(".score").textContent = data.score + "%";

        // Matched Skills
        const matchedContainer = document.querySelectorAll(".card")[1];
        matchedContainer.innerHTML = "<h3>Matched Skills</h3><br>";
        data.matched.forEach(skill => {
            matchedContainer.innerHTML += 
                `<span class="skill-tag">${skill}</span>`;
        });

        // Missing Skills
        const missingContainer = document.querySelectorAll(".card")[2];
        missingContainer.innerHTML = "<h3>Missing Keywords</h3><br>";
        data.missing.forEach(skill => {
            missingContainer.innerHTML += 
                `<span class="skill-tag missing">${skill}</span>`;
        });

        // Suggestions
        const suggestionCard = document.querySelectorAll(".card")[3];
        suggestionCard.innerHTML = "<h3>AI Suggestions</h3><br>";
        data.feedback.forEach(text => {
            suggestionCard.innerHTML += 
                `<div class="suggestion">‚úî ${text}</div>`;
        });

    } catch (error) {
        alert("Server error");
        console.error(error);
    }
});
</script>

</body>
</html>
